
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.0">
    
    
      
        <title>Identification - Home Alarm</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bc7e593a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab28b872.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rfid-identification-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Home Alarm" class="md-header-nav__button md-logo" aria-label="Home Alarm">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Home Alarm
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Identification
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Home Alarm" class="md-nav__button md-logo" aria-label="Home Alarm">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Home Alarm
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../requirements/" class="md-nav__link">
      Requirements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Configuration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Configuration" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config/" class="md-nav__link">
      Main Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/alexa/" class="md-nav__link">
      Alexa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/others/" class="md-nav__link">
      Google Home & Others
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Alerts
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Alerts" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Alerts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../alerts/media_player/" class="md-nav__link">
      Media Player
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alerts/notifier/" class="md-nav__link">
      Notifier
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alerts/light/" class="md-nav__link">
      Light
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alerts/xiaomi_gateway/" class="md-nav__link">
      Xiaomi Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alerts/switch/" class="md-nav__link">
      Switch
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Identification
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Identification
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemas" class="md-nav__link">
    Schemas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    Files
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemas" class="md-nav__link">
    Schemas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    Files
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="rfid-identification-system">RFID Identification system</h1>
<p>In this section it is shown the RFID identification system and how it works with Home Alarm. It is a handmade system that anyone can make it at their homes using basic and cheap components.</p>
<h2 id="components">Components</h2>
<ul>
<li>ESP32: This is the brain of the system. It is a microcontroller board that connects RFID reader and sends/reads MQTT messages to/from our Home Assitant MQTT broker. </li>
</ul>
<p><img alt="ESP32" src="../images/rfid/esp32.jpeg" width="200" /></p>
<ul>
<li>RC522: RFID Card reader.</li>
</ul>
<p><img alt="RC522" src="../images/rfid/rc522.jpeg" width="200" /></p>
<ul>
<li>RFID Tag: Passive device that identifies a person in the system.</li>
</ul>
<p><img alt="RFID Tag" src="../images/rfid/rfid_tag.jpeg" width="100" /></p>
<ul>
<li>Green LED: Led component to know visually if the <code>safe_mode</code> is activated or not.</li>
</ul>
<p><img alt="Green LED" src="../images/rfid/green_led.png" width="100" /></p>
<ul>
<li>Resistor 100 Ohms: To limit the intensity passing through the LED.</li>
</ul>
<p><img alt="Resistor 100" src="../images/rfid/resistor_100.jpeg" width="100" /></p>
<ul>
<li>Jumpers: To wire components.</li>
</ul>
<p><img alt="Jumpers" src="../images/rfid/jumpers.jpeg" width="100" /></p>
<ul>
<li>Protoboard: To connect all the components and test the environment.</li>
</ul>
<p><img alt="Protoboard" src="../images/rfid/proto.jpeg" width="100" /></p>
<h2 id="schemas">Schemas</h2>
<p>Left connections:</p>
<ul>
<li><strong>Pin 2 (GND) ESP32 - LED cathode (the shorter leg of the LED)</strong> [black wire]</li>
<li><strong>Pin 4 (GPIO12) ESP32 - Resistor 100 Ohms - LED anode (the longer leg of the LED)</strong> [gray wire]</li>
</ul>
<p>Right connections:</p>
<ul>
<li><strong>Pin 1 (VDD 3V3) ESP32 - 3.3V RC522</strong> [red wire]</li>
<li><strong>Pin 2 (GND) ESP32 - GND RC522</strong> [gray wire]</li>
<li><strong>Pin 9 (GPIO18) ESP32 - SCK RC522</strong> [violet wire]</li>
<li><strong>Pin 10 (GPIO19) ESP32 - MISO RC522</strong> [violet wire]</li>
<li><strong>Pin 11 (GPIO21) ESP32 - SDA RC522</strong> [green wire]</li>
<li><strong>Pin 14 (GPIO22) ESP32 - RST RC522</strong> [orange wire]</li>
<li><strong>Pin 15 (GPIO23) ESP32 - MOSI RC522</strong> [yellow wire]</li>
</ul>
<p><img alt="Schema" src="../images/rfid/schema.png" /></p>
<p><img alt="Schema" src="../images/rfid/proto_rc522.jpg" width="325" />
<img alt="Schema" src="../images/rfid/proto_esp.jpg" width="325" />
<img alt="Schema" src="../images/rfid/box_open.jpg" width="325" />
<img alt="Schema" src="../images/rfid/box_closed.jpg" width="325" /></p>
<h2 id="installation">Installation</h2>
<p>For having this system working it is needed the <code>ESPHome</code> integration installed in HA, the <code>safe_mode</code> input boolean created in HA and the MQTT broker. </p>
<p>First of all we need to flash our <em>ESP32</em> through the <em>ESPHome</em> integration. For doing that we have to connect the ESP32 to an USB port from our HA (just for the first load, after that we will be able to flash it through OTA). For flashing correctly the ESP32 it is need two files, the <code>ESPHome</code> <a href="https://github.com/crserran/home-alarm/blob/dev/rfid/esp_identification.yaml">configuration file</a> and our <a href="https://github.com/crserran/home-alarm/blob/dev/rfid/rc522_sensor.h">custom file</a> that contains all the logic of our app. These files are placed in <code>/config/esphome/</code> directory. Alternativelly you can add a secrets.yaml file to that folder to keep save your WiFi and MQTT passwords and others. Once you have it you can flash your ESP32 via USB and remember that some ESP32 the <code>boot</code> button has to be pressed to flash the software correclty.</p>
<p>Now you will be able to see two new entities in our Home Assistant that are <code>rfid_real_time</code> and <code>rfid_last_read</code>. Then, we can add an automation for controlling the <code>safe_mode</code> with the <code>rfid_real_time</code>. You just need to know the ids of your RFID tags that can be obtained through ESPHome integration and logs. <a href="https://github.com/crserran/home-alarm/blob/dev/rfid/automations.yaml">Add the automation</a>. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>User can add multiple RFID tags just adding their IDs to the automation file in <code>value_template</code> concatenating <code>or</code>.</p>
</div>
<h2 id="how-it-works">How it works?</h2>
<p>This RFID identification system is a complementary app that can be used with Home Alarm. The purpose of that is to active or disarm the alarm using the RFID system working with the <code>safe_mode</code> input. One can activate the House safe mode just moving closer its RFID tag to RFID reader. User will know that the save mode is activated just watching if the green LED is on, otherwise it means that safe mode is not activated.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Remember that for Home Alarm we have a configuration variable that is call <code>safe_mode_delay</code> in <code>apps.yaml</code>. You can configure this variable to activate your Home safe mode with a delay in order to have time to leave the house. In that time, the alarm won't be fired.</p>
</div>
<p>ESP32 is subscribed to an MQTT topic in order to know if the <code>safe_mode</code> is activated or not and toggle the LED when the state changes. Our automation created reads the RFID tag id and check if there is a known tag and in positive case publish an MQTT message for activate or deactivate safe mode.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If alarm is fired and you are at home, you can disarm it by moving closer the RFID tag to the reader in order to deactivate the <code>safe_mode</code> input.</p>
</div>
<h2 id="files">Files</h2>
<ul>
<li><a href="https://github.com/crserran/home-alarm/blob/dev/rfid/esp_identification.yaml">Configuration file</a> </li>
<li><a href="https://github.com/crserran/home-alarm/blob/dev/rfid/rc522_sensor.h">ESP32 App</a> </li>
<li><a href="https://github.com/crserran/home-alarm/blob/dev/rfid/automations.yaml">Automation</a></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../alerts/switch/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Switch
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.6a3d08fc.min.js"></script>
      <script src="../assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>